<!-- Bloc Prédiction Individuelle -->
<div class="flex flex-wrap gap-10 items-center justify-center p-6">

  <!-- Bloc prédiction individuelle -->
  <div class="max-w-sm w-full">
    <h2 class="text-2xl font-semibold mb-4">Prédiction sur un échantillon test</h2>
    <form method="get" class="space-y-4">
      <label for="test_index" class="block text-gray-700 font-medium mb-1">
        Index (0 à {{ X_test|length - 1 }}):
      </label>
      <input
        type="number"
        id="test_index"
        name="test_index"
        value="{{ test_index }}"
        min="0"
        max="{{ X_test|length - 1 }}"
        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
      >
      <input
        type="submit"
        value="Prédire"
        class="cursor-pointer bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"
      >
    </form>
    <p class="mt-4 text-gray-800">Vraie étiquette : {{ true_label }}</p>
    <p class="mt-2 font-bold text-lg">Prédiction finale : {{ prediction }}</p>
  </div>

  <!-- Cercle de précision globale -->
  {% if global_accuracy is not none %}
  <div class="relative w-40 h-40 flex items-center justify-center">
    <svg viewBox="0 0 36 36" class="transform -rotate-90 w-40 h-40">
      <path
        d="M18 2.0845
           a 15.9155 15.9155 0 0 1 0 31.831
           a 15.9155 15.9155 0 0 1 0 -31.831"
        fill="none"
        stroke="#eee"
        stroke-width="4"
      />
      <path
        d="M18 2.0845
           a 15.9155 15.9155 0 0 1 0 31.831"
        fill="none"
        stroke="{% if global_accuracy > 50 %}#16a34a{% else %}#dc2626{% endif %}"  <!-- Vert ou rouge Tailwind -->
        stroke-width="4"
        stroke-dasharray="{{ global_accuracy }}, 100"
      />
    </svg>
    <div class="absolute inset-0 flex items-center justify-center text-2xl font-bold">
      {{ global_accuracy }}%
    </div>
  </div>
  {% endif %}
  <!-- Camembert des features utilisés -->
  <div class="mt-10 w-full max-w-md">
    <h3 class="text-xl font-semibold mb-4">Répartition pondérée des features</h3>
    <canvas id="featurePie" width="400" height="400"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const featureData = {{ feature_distribution | tojson }};
  const ctx = document.getElementById('featurePie').getContext('2d');
  const featurePie = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: featureData.map(f => f.name),
      datasets: [{
        data: featureData.map(f => f.value),
        backgroundColor: featureData.map((_, i) => 
          ['#16a34a', '#22c55e', '#4ade80', '#86efac', '#facc15', '#fb923c', '#f472b6', '#60a5fa', '#a78bfa', '#38bdf8'][i % 10]
        )
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Features utilisées (pondérées par arbre)'
        },
        legend: {
          position: 'bottom'
        }
      }
    }
  });
</script>


